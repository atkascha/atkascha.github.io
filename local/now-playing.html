<html>
  <head>
    <style>
      @font-face {
        font-family: 'Epsilon';
        src: url('https://atkascha.vercel.app/fonts/Epsilon.ttf');
      }

      #song {
        color: #FFF;
        font-family: 'Epsilon';
        font-size: 18px;
        position: fixed;
          bottom: 10;
          left: 10;
        text-shadow: 0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black;
      }
    </style>
  </head>
  <body>
    <button onclick="player.playNextSong()">debug play</button>
    <div id="song"></div>
    <audio>
      <source />
    </audio>
  </body>
  <script>

    // specific playlist based on query params
    const DEBUG = false;
    const SONG = document.getElementById('song');
    // const BASE_URL = 'https://atkascha.vercel.app/audio/'
    const BASE_URL = '../public/audio/'
    const AUDIO = document.querySelector('audio');
    const SOURCE = document.querySelector('source');
    const SONGS = [
      'Epidemic Sound/Intrusive - T-Shirts & Sweats.mp3',
      'Epidemic Sound/Adrenaline Junkie - T-Shirts & Sweats.mp3',
      'Epidemic Sound/How to Treat You Right (Ruzer Remix) (Instrumental Version) - Mia Pfirrman.mp3',
      'Epidemic Sound/As the Sun Goes Down - Tomas Skyldeberg.mp3',
      'Epidemic Sound/Aurealis - Stray Bandit.mp3',
      'Epidemic Sound/Aveny - Roral Ceef.mp3',
      'Epidemic Sound/Bar 24 - Roral Ceef.mp3',
      'Epidemic Sound/Egyptian Cotton (Hamburg Remix) - Cave Cadence.mp3',
      'Epidemic Sound/Hello My Friend - Lovren.mp3',
      'Epidemic Sound/Late Night Traffic - Raynie.mp3',
      'Epidemic Sound/Mars - Stray Bandit.mp3',
      'Epidemic Sound/Penguin Fiesta - Magnofield.mp3',
      'Epidemic Sound/Season - Roral Ceef.mp3',
      'Epidemic Sound/Untruth - Felix Johansson Carne.mp3',
      'Epidemic Sound/Infinite Scroll - Thip Trong.mp3',
      'Epidemic Sound/Ritual Burning - Mantell.mp3',
      'Epidemic Sound/List of Patterns - Xack.mp3',
      'Epidemic Sound/Berlin - Xack.mp3',
      'Epidemic Sound/All Ends Loose - Truvio.mp3',
      'Epidemic Sound/Rip It Apart - Truvio.mp3',
      'Epidemic Sound/Northen Lights - Liru.mp3',
      'Epidemic Sound/Coming Out - Typekast.mp3',
      'Epidemic Sound/Hidden Mainframe - Liru.mp3',
      'Epidemic Sound/Another Level - Liru.mp3',
      'Epidemic Sound/Doll Face - Liru.mp3',
      'Epidemic Sound/UCT - T-Shirts & Sweats.mp3',
      'Epidemic Sound/jonquilla - T-Shirts & Sweats.mp3',
      'Epidemic Sound/nous - T-Shirts & Sweats.mp3',
      'Disasterpeace/Deorbit (B-Sides)/Disasterpeace - Polis.mp3',
      'Disasterpeace/Midnight Orphans/Disasterpeace - St. Valentine.mp3',
      'Pilotpriest/I Just Woke Up/PILOTPRIEST - I Just Woke Up.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Body Double.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - After Hours.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Miracle Mile.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Manhunter.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Risky Business.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Quest For Fire(Instrumental).mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Walkabout.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Rumblefish.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Streets of Fire.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Thief.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Firefox.mp3',
      "Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Don't Look Now.mp3",
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - The Black Hole.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Red Dawn.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Silver Bullet(Love Theme).mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - The Last Dragon.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Legend.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Cruising.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Less Than Zero.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - The Golden Child.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Xanadu.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Rad.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Flight Of The Navigator.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - Pyramid - Run(Pilotpriest Remix).mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - The Canyons.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - Switchblade.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - Blaupunkt.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - They Live.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - Black Rain.mp3',
      'Pilotpriest/Original Motion Picture Soundtrack/PILOTPRIEST - Bonus Track - Cat People.mp3',
    ]

    const TEST_SONGS = [
      'https://www.kozco.com/tech/organfinale.mp3',
      'https://www.kozco.com/tech/piano2-CoolEdit.mp3'
    ]

    class Player {
      constructor(params) {
        this.baseUrl = params.baseUrl;
        this.audio = params.audio;
        this.source = params.source;
        this.songDiv = params.songDiv;
        this.playedSongs = [];
        this.unplayedSongs = params.songList;
        this.currentSong = null;
        this.audio.onended = () => {
          this.playNextSong()
        };
      }

      moveFromUnplayedtoPlayed(song, index) {
        this.playedSongs.push(song);
        this.unplayedSongs.splice(index, 1);
      }

      getNextSong() {
        let index = Math.floor(Math.random() * this.unplayedSongs.length);
        let songName = this.unplayedSongs[index];
        let song = BASE_URL + songName;
        this.setSongName(songName);
        this.moveFromUnplayedtoPlayed(song, index);
        if (this.unplayedSongs.length === 0) {
          this.unplayedSongs = this.playedSongs;
          this.playedSongs = [];
        }
        return song;
      }

      playNextSong() {
        let song = this.getNextSong();
        console.log('playing: ', song)
        this.currentSong = song;
        this.audio.src = song;
        this.audio.play();
      }

      setSongName(songName) {
        this.songDiv.style.display = 'block';
        let songNameArray = songName.split('/');
        this.songDiv.innerHTML = songNameArray[songNameArray.length - 1].split('.mp3')[0];
        setTimeout(() => {
          this.songDiv.style.display = 'none';
        }, 10000);
      }
    }

    const player = new Player({
      baseUrl: BASE_URL,
      audio: AUDIO,
      source: SOURCE,
      songList: SONGS,
      songDiv: SONG
    });

    if (!DEBUG) {
      player.playNextSong();
      document.querySelector('button').style.display = 'none'
    } else {
      document.querySelector('button').addEventListener('click', (e) => {
        e.target.style.display = 'none'
      })
    }

    document.querySelector('body').addEventListener('click', (e) => {
      player.songDiv.style.display = 'block'
      setTimeout(() => {
        player.songDiv.style.display = 'none'
      }, 10000)
    })

  </script>
</html>
